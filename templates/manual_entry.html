{% extends 'base.html' %}{% block content %}
<h3>Lançamentos</h3>
<div class="row g-4">
  <div class="col-lg-6"><div class="card p-4">
    <h5>Novo lançamento</h5>
    <form method="post">
      <div class="mb-2">
        <label class="form-label">Map</label>
        <select class="form-select" name="map">
          {% for m in maps %}<option value="{{ m.name }}">{{ m.name }}</option>{% endfor %}
        </select>
      </div>
      <div class="mb-2">
        <label class="form-label">Type</label>
        {% if types %}
        <select class="form-select" name="type" required>
          {% for t in types %}<option value="{{ t.name }}">{{ t.name }}</option>{% endfor %}
        </select>
        {% else %}
        <div class="alert alert-warning mt-2">Cadastre tipos de dispositivo em <b>Configurações</b> antes de lançar.</div>
        {% endif %}
      </div>
      <div class="mb-2">
        <label class="form-label">Device (nome)</label>
        <input class="form-control" name="device" placeholder="Ex.: SCA10470007" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Splices (nº de fusões)</label>
        <input class="form-control" type="number" min="0" name="splices" value="0" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Splicer (quem fez)</label>
        <input class="form-control" name="splicer" placeholder="Seu nome">
      </div>
      <div class="mb-3">
        <label class="form-label">Data (Created)</label>
        <input class="form-control" type="date" name="created">
      </div>
      <button class="btn btn-primary">Salvar lançamento</button>
    </form>
  </div></div>
  <div class="col-lg-6"><div class="card p-4">
    <h5>Últimos lançamentos</h5>
    <div class="table-responsive" style="max-height:60vh">
      <table class="table table-sm table-dark">
        <thead><tr><th>Data</th><th>Map</th><th>Type</th><th>Device</th><th>Splices</th><th>Total</th><th class="text-end">Ações</th></tr></thead>
        <tbody>
          {% for r in recent %}
            <tr>
              <td>{{ r.created_date.date() if r.created_date else '' }}</td>
              <td>{{ r.map }}</td>
              <td>{{ r.type }}</td>
              <td>{{ r.device }}</td>
              <td>{{ r.splices }}</td>
              <td>$ {{ '%.2f'|format(r.total_usd or 0) }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-danger" href="{{ url_for('record_delete', rid=r.id, next='manual') }}">Excluir</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div></div>
</div>
{% endblock %}